#!/usr/bin/env bash

# Just a nice little alias so I can open chrome with switches easily
alias chrome='/Applications/Google\ Chrome.app/Contents/MacOS/Google\ Chrome'
alias su='su -'

# Easily clone GitHub repos: gh-clone <user> <repo> [<clone-path>]
function gh-clone(){
    git clone "git@github.com:$1/$2.git" $3
}

# Easily clone BitBucket repos: bb-clone <user> <repo> [<clone-path>]
function bb-clone(){
    git clone "git@bitbucket.com:$1/$2.git" $3
}

# For Django: run manage.py in either the project or app level
function m(){
    if [ -e manage.py ]; then
        python manage.py "$@"
    else
        if [ -e ../manage.py ]; then
            python ../manage.py "$@"
        else
            echo "Cannot find manage.py."
        fi
    fi
}

# For keeping a list of directories for quick switching
function d(){
    if [[ $1 != '' ]] && [[ $1 != '+' ]] && [[ $1 != '-' ]] && [ $1 -eq $1 ] 2>/dev/null; then
        dr=$(python $HOME/.cmd/pyd.py $@)

        ex=$?

        echo $dr

        if [ $ex -eq 0 ]; then
            cd "$dr"
        fi
    else
        python $HOME/.cmd/pyd.py $@
    fi
}

pmancache=$HOME/.pmancache

function cache_man_pdf () {
    if ! [[ -f "$pmancache/$@.pdf" ]]; then
        man -t "$@" > "$pmancache/$@.ps"

        if [ $? -eq 0 ]; then
            echo "Caching man page for $@."
            pstopdf "$pmancache/$@.ps" -o "$pmancache/$@.pdf" > /dev/null 2>&1
        else
            return 1
        fi

        rm "$pmancache/$@.ps"
    fi
}

function pman () {
    cache_man_pdf "$@"

    if [ $? -eq 0 ]; then
        open -a Preview "$pmancache/$@.pdf"
    else
        return 1
    fi
}

function pmandb () {
    if ! [[ -d $pmancache ]]; then
        mkdir -p $pmancache
    fi

    manpages=$(man -k . | perl -pe 's/(.+) - .+/\1/' | perl -pe 's/\(.*?\)(?:, )?/\1\n/g' | egrep -v "^[[:space:]]*$")

    for i in $manpages; do
        cache_man_pdf "$i" 2> /dev/null
    done
}

function sman () {
    man "$@" | col -b | subl
}
